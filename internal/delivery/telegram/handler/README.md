# Handler Architecture

Этот пакет реализует обработчики для Telegram бота с использованием чистой архитектуры и разделением ответственности.

## Структура

```
internal/delivery/telegram/handler/
├── handler.go              # Основной координатор
├── commands/               # Базовые команды
│   ├── basic.go           # /start, /help
│   └── reminder_crud.go   # /list, /edit, /delete, /pause, /resume, /add
├── wizards/               # Пошаговые мастера
│   ├── add_reminder.go    # Мастер добавления напоминаний
│   └── timezone.go        # Мастер настройки таймзоны
├── ui/                    # UI компоненты
│   ├── menus.go          # Inline меню и кнопки
│   └── formatters.go     # Форматирование ответов
├── utils/                 # Вспомогательные утилиты
│   └── time_calculator.go # Расчет времени напоминаний
└── add_wizard_test.go     # Тесты
```

## Компоненты

### 1. Handler (координатор)
- **Файл**: `handler.go`
- **Ответственность**: Объединяет все компоненты и регистрирует обработчики
- **Зависимости**: Все остальные компоненты

### 2. Commands (команды)
Обрабатывают прямые команды от пользователя:

#### BasicCommands
- **Файл**: `commands/basic.go`
- **Команды**: `/start`, `/help`
- **Ответственность**: Базовая функциональность бота

#### ReminderCRUD
- **Файл**: `commands/reminder_crud.go`
- **Команды**: `/add`, `/list`, `/edit`, `/delete`, `/pause`, `/resume`
- **Ответственность**: CRUD операции с напоминаниями

### 3. Wizards (мастера)
Обрабатывают многошаговые процессы:

#### AddReminderWizard
- **Файл**: `wizards/add_reminder.go`
- **Ответственность**: Пошаговое создание напоминаний
- **Типы**: today, tomorrow, everyday, week, ndays, month, year, date, multiday

#### TimezoneWizard
- **Файл**: `wizards/timezone.go`
- **Ответственность**: Настройка часового пояса пользователя

### 4. UI (пользовательский интерфейс)
#### Menus
- **Файл**: `ui/menus.go`
- **Ответственность**: Inline клавиатуры и кнопки
- **Экспорт**: `GetMainMenu()`, `GetAddMenu()`, `WeekdaysMenu()`

#### Formatters
- **Файл**: `ui/formatters.go`
- **Ответственность**: Форматирование данных для отображения
- **Функции**: `FormatRepeat()`

### 5. Utils (утилиты)
#### TimeCalculator
- **Файл**: `utils/time_calculator.go`
- **Ответственность**: Расчет времени для различных типов напоминаний
- **Методы**: `GetNextTimeToday()`, `GetNextTimeTomorrow()`, и др.

## Принципы архитектуры

### 1. Разделение ответственности
- Каждый компонент отвечает за конкретную область функциональности
- Нет пересечения зон ответственности между компонентами

### 2. Зависимости
- Компоненты зависят только от интерфейсов, а не от конкретных реализаций
- Dependency Injection через конструкторы

### 3. Тестируемость
- Каждый компонент можно тестировать изолированно
- Все зависимости инжектируются и могут быть замокированы

### 4. Масштабируемость
- Новые команды добавляются в соответствующий пакет
- Новые мастера создаются как отдельные компоненты
- UI компоненты переиспользуются между разными обработчиками

## Использование

```go
// Создание handler'а
handler := NewHandler(bot, reminderUsecase, userUsecase)

// Регистрация всех обработчиков
handler.Register()
```

## Добавление новых функций

### Новая команда
1. Добавить метод в соответствующий *Commands struct
2. Зарегистрировать в `handler.Register()`

### Новый мастер
1. Создать новый файл в `wizards/`
2. Реализовать методы обработки шагов
3. Добавить в Handler struct и `NewHandler()`
4. Зарегистрировать обработчики в `Register()`

### Новый UI компонент
1. Добавить в `ui/menus.go` или `ui/formatters.go`
2. Экспортировать для использования в других компонентах 